"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[507],{89588:function(N,B,t){t.d(B,{L:function(){return h}});var h=[{value:"AVAILABLE",label:"\u53EF\u501F\u9605",badgeStatus:"success"},{value:"BORROWED",label:"\u5DF2\u501F\u5B8C",badgeStatus:"error"},{value:"MAINTENANCE",label:"\u6682\u505C\u501F\u9605",badgeStatus:"default"}]},77231:function(N,B,t){t.r(B);var h=t(97857),_=t.n(h),A=t(15009),f=t.n(A),E=t(99289),D=t.n(E),g=t(5574),c=t.n(g),P=t(4318),M=t(61370),O=t(58780),H=t(62362),S=t(51042),w=t(88484),U=t(90930),Q=t(95881),T=t(37476),k=t(5966),R=t(64317),X=t(2485),Z=t(55102),o=t(8232),d=t(40411),i=t(2453),l=t(16568),u=t(83622),le=t(74330),q=t(71230),F=t(15746),_e=t(78367),ye=t(85265),Ae=t(17788),b=t(67294),ke=t(11475),Y=t(89588),ee=t(96486),ft=t.n(ee),n=t(85893),Fe=Z.Z.TextArea,Le=function(){var te,ne,Se=o.Z.useForm(),Te=c()(Se,1),J=Te[0],Re=o.Z.useForm(),xe=c()(Re,1),de=xe[0],W=(0,b.useRef)(),Ue=(0,b.useState)(),ce=c()(Ue,2),C=ce[0],pe=ce[1],Ze=(0,b.useState)([]),me=c()(Ze,2),We=me[0],Ke=me[1],Ne=(0,b.useState)(!1),fe=c()(Ne,2),we=fe[0],Ye=fe[1],Je=(0,b.useState)(!1),Ee=c()(Je,2),$e=Ee[0],re=Ee[1],Ge=(0,b.useState)("\u6DFB\u52A0"),be=c()(Ge,2),$=be[0],ae=be[1],ze=(0,b.useState)(!1),ge=c()(ze,2),Ve=ge[0],x=ge[1],He=(0,b.useState)(!1),ve=c()(He,2),Qe=ve[0],K=ve[1],Xe=(0,b.useState)({current:[],original:[]}),De=c()(Xe,2),I=De[0],G=De[1],qe=(0,b.useState)({current:[],original:[]}),he=c()(qe,2),j=he[0],z=he[1],et=(0,b.useState)([]),Be=c()(et,2),V=Be[0],tt=Be[1],nt=(0,b.useState)(!1),Pe=c()(nt,2),rt=Pe[0],ue=Pe[1],at=(0,b.useState)(!1),Oe=c()(at,2),ut=Oe[0],Ce=Oe[1],st=(0,b.useState)(!1),Me=c()(st,2),ot=Me[0],se=Me[1],it=(0,b.useState)(!1),Ie=c()(it,2),lt=Ie[0],oe=Ie[1],_t=[{title:"ID",dataIndex:"id",ellipsis:!0,width:50},{title:"\u4E66\u540D",dataIndex:"title",ellipsis:!0,render:function(e,r){return(0,n.jsx)("a",{onClick:function(){ue(!0),Ce(!0),(0,P.qU)({bookId:r.id}).then(function(p){Ce(!1),r.bookNumber=p.data,pe(r)})},children:r.title})}},{title:"\u4F5C\u8005",dataIndex:"author",ellipsis:!0},{title:"\u7C7B\u522B",dataIndex:"categoryId",ellipsis:!0,valueType:"select",fieldProps:{options:V},render:function(e,r){var a=V.find(function(p){return p.value===r.categoryId});return a?a.label:"\u672A\u77E5\u7C7B\u522B"}},{title:"\u72B6\u6001",dataIndex:"status",valueType:"select",fieldProps:{options:Y.L},ellipsis:!0,render:function(e,r){var a=Y.L.find(function(p){return p.value===r.status});return a?(0,n.jsx)(d.Z,{status:a.badgeStatus,text:a.label}):"\u672A\u77E5\u72B6\u6001: ".concat(r.status)}},{title:"\u66F4\u65B0\u65F6\u95F4",dataIndex:"updatedAt",valueType:"dateTime",search:!1,ellipsis:!0},{title:"\u64CD\u4F5C",dataIndex:"option",valueType:"option",width:100,render:function(e,r){return[(0,n.jsx)("a",{onClick:function(){pe(r),x(!0),ae("\u7F16\u8F91"),je(r)},children:"\u7F16\u8F91"},"edit-".concat(r.id))]}}],dt=function(){var s=D()(f()().mark(function e(r){var a;return f()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return r=(0,O.cz)(r),re(!0),v.next=4,(0,P.zl)(r);case 4:if(a=v.sent,a.status!=="fail"){v.next=9;break}return i.ZP.error(a.msg),re(!1),v.abrupt("return");case 9:return re(!1),Ke(a.data.data.map(function(m){return{id:m.id,title:m.title,author:m.author,categoryId:m.categoryId,status:m.status,createdAt:m.createdAt,cover:m.cover?(0,O.OR)(m.cover):m.cover,ebook:m.ebook?(0,O.OR)(m.ebook):m.ebook,intro:m.intro,press:m.press,isbn:m.isbn,updatedAt:m.updatedAt}})),v.abrupt("return",a.data);case 12:case"end":return v.stop()}},e)}));return function(r){return s.apply(this,arguments)}}(),ct=function(){},pt=function(){Ye(!1)},ie=function(){J.resetFields(),z({current:[],original:[]}),G({current:[],original:[]})},je=function(e){if(e){if(J.setFieldsValue({title:e.title,isbn:e.isbn,author:e.author,press:e.press,categoryId:e.categoryId,status:e.status,intro:e.intro}),e.cover){var r={uid:"-cover",name:(0,O.w2)(e.cover),status:"done",url:e.cover};G({current:[r],original:[r]})}if(e.ebook){var a={uid:"-ebook",name:(0,O.w2)(e.ebook),status:"done",url:e.ebook};z({current:[a],original:[a]})}}};(0,b.useEffect)(function(){(0,M.A)().then(function(s){tt(s.data.map(function(e){return{label:e.name,value:e.id}}))})},[]);var mt=function(){var s=D()(f()().mark(function e(r){var a,p,v,m;return f()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if($!=="\u6DFB\u52A0"){y.next=8;break}a={bookData:r},I.current[0]&&(a.cover=I.current[0].originFileObj),j.current[0]&&(a.file=j.current[0].originFileObj),K(!0),(0,P.ak)(a).then(function(L){K(!1),L.status==="success"?(l.ZP.destroy(),l.ZP.success({message:L.msg}),W.current&&W.current.reload(),x(!1),ie()):(l.ZP.destroy(),l.ZP.error({message:L.msg}))}),y.next=19;break;case 8:if($!=="\u7F16\u8F91"){y.next=19;break}if(C){y.next=12;break}return i.ZP.error("\u5F53\u524D\u64CD\u4F5C\u8BB0\u5F55\u4E0D\u8BE6\uFF0C\u8BF7\u91CD\u8BD5"),y.abrupt("return");case 12:K(!0),p={bookId:C.id,bookData:r},v=I.original!=null&&!(0,ee.isEqual)(I.current,I.original),v&&(p.cover=I.current[0].originFileObj),m=j.original!=null&&!(0,ee.isEqual)(j.current,j.original),m&&(p.file=j.current[0].originFileObj),(0,P.u8)(p).then(function(L){K(!1),L.status==="success"?(l.ZP.destroy(),l.ZP.success({message:L.msg}),W.current&&W.current.reload(),x(!1),ie()):(l.ZP.destroy(),l.ZP.error({message:L.msg}))});case 19:case"end":return y.stop()}},e)}));return function(r){return s.apply(this,arguments)}}();return(0,n.jsxs)(U._z,{title:"\u4E66\u7C4D\u7BA1\u7406",children:[(0,n.jsx)(Q.Z,{headerTitle:"\u4E66\u7C4D\u5217\u8868",actionRef:W,rowKey:"id",pagination:{pageSize:5},loading:$e,toolBarRender:function(){return[(0,n.jsxs)(u.ZP,{type:"primary",onClick:function(){ae("\u6DFB\u52A0"),x(!0)},children:[(0,n.jsx)(S.Z,{})," \u6DFB\u52A0\u4E66\u7C4D"]},"primary"),(0,n.jsxs)(u.ZP,{type:"primary",onClick:function(){se(!0)},children:[(0,n.jsx)(S.Z,{})," \u6DFB\u52A0\u7C7B\u522B"]},"primary")]},request:dt,columns:_t,dataSource:We}),(0,n.jsx)(T.Y,{title:"\u6DFB\u52A0\u4E66\u7C4D\u7C7B\u522B",width:"400px",form:de,open:ot,onOpenChange:function(e){se(e),e||oe(!1)},onFinish:function(){var s=D()(f()().mark(function e(r){return f()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:oe(!0);try{(0,P.i8)({CategoryName:r.categoryName}).then(function(v){v.status==="fail"?i.ZP.error(v.msg):(se(!1),de.resetFields(),i.ZP.success("\u7C7B\u522B\u6DFB\u52A0\u6210\u529F\uFF1A"+r.categoryName))})}catch(v){i.ZP.error("\u7C7B\u522B\u6DFB\u52A0\u5931\u8D25")}finally{oe(!1)}case 2:case"end":return p.stop()}},e)}));return function(e){return s.apply(this,arguments)}}(),children:(0,n.jsx)(le.Z,{spinning:lt,tip:"\u6DFB\u52A0\u4E2D...",children:(0,n.jsx)(k.Z,{label:"\u7C7B\u522B\u540D\u79F0",rules:[{required:!0,message:"\u7C7B\u522B\u540D\u79F0\u5FC5\u586B\uFF01"}],name:"categoryName",placeholder:"\u8BF7\u8F93\u5165\u7C7B\u522B\u540D\u79F0"})})}),(0,n.jsx)(T.Y,{title:$+"\u4E66\u7C4D",width:"800px",form:J,open:Ve,onOpenChange:function(e){x(e),e||(ie(),K(!1))},onFinish:mt,children:(0,n.jsxs)(le.Z,{spinning:Qe,tip:"\u4E0A\u4F20\u4E2D...",children:[(0,n.jsxs)(q.Z,{gutter:16,children:[(0,n.jsx)(F.Z,{span:12,children:(0,n.jsx)(k.Z,{label:"\u4E66\u540D",rules:[{required:!0,message:"\u4E66\u540D\u5FC5\u586B\uFF01"}],name:"title",placeholder:"\u8BF7\u8F93\u5165\u4E66\u540D"})}),(0,n.jsx)(F.Z,{span:12,children:(0,n.jsx)(k.Z,{label:"ISBN",rules:[{required:!0,message:"ISBN\u5FC5\u586B\uFF01"}],name:"isbn",placeholder:"\u8BF7\u8F93\u5165ISBN"})})]}),(0,n.jsxs)(q.Z,{gutter:16,children:[(0,n.jsx)(F.Z,{span:12,children:(0,n.jsx)(k.Z,{label:"\u4F5C\u8005",rules:[{required:!0,message:"\u4F5C\u8005\u5FC5\u586B\uFF01"}],name:"author",placeholder:"\u8BF7\u8F93\u5165\u4F5C\u8005"})}),(0,n.jsx)(F.Z,{span:12,children:(0,n.jsx)(k.Z,{label:"\u51FA\u7248\u793E",rules:[{required:!0,message:"\u51FA\u7248\u793E\u5FC5\u586B\uFF01"}],name:"press",placeholder:"\u8BF7\u8F93\u5165\u51FA\u7248\u793E"})})]}),(0,n.jsxs)(q.Z,{gutter:16,children:[(0,n.jsx)(F.Z,{span:8,children:(0,n.jsx)(R.Z,{label:"\u7C7B\u522B",name:"categoryId",rules:[{required:!0,message:"\u7C7B\u522B\u5FC5\u9009\uFF01"}],options:V,placeholder:"\u8BF7\u9009\u62E9\u7C7B\u522B"})}),(0,n.jsx)(F.Z,{span:8,children:(0,n.jsx)(R.Z,{label:"\u72B6\u6001",name:"status",rules:[{required:!0,message:"\u72B6\u6001\u5FC5\u9009\uFF01"}],initialValue:"MAINTENANCE",options:Y.L,placeholder:"\u8BF7\u9009\u62E9\u72B6\u6001"})}),(0,n.jsx)(F.Z,{span:8,children:(0,n.jsx)(k.Z,{label:"\u5E93\u5B58",rules:[{required:!0,message:"\u5E93\u5B58\u6570\u91CF\u5FC5\u586B\uFF01"}],initialValue:0,name:"bookNumber",placeholder:"\u8BF7\u8F93\u5165\u5E93\u5B58\u6570\u91CF",fieldProps:{type:"number",min:0,onChange:function(e){var r=e.target.value;r==="0"&&J.setFieldsValue({status:"MAINTENANCE"})}}})})]}),(0,n.jsx)(o.Z.Item,{label:"\u4E66\u7C4D\u7B80\u4ECB",name:"intro",children:(0,n.jsx)(Fe,{rows:4,placeholder:"\u8BF7\u8F93\u5165\u4E66\u7C4D\u7B80\u4ECB"})}),(0,n.jsx)(o.Z.Item,{label:"\u4E66\u7C4D\u5C01\u9762",children:(0,n.jsx)(_e.Z,{fileList:I.current,beforeUpload:function(e){if((0,H.v)(e)){var r={uid:e.uid,name:e.name,status:"done",originFileObj:e};G(function(a){return _()(_()({},a),{},{current:[r]})})}return!1},onRemove:function(){G(function(e){return _()(_()({},e),{},{current:[]})})},children:!((te=I.current)!==null&&te!==void 0&&te.length)&&(0,n.jsx)(u.ZP,{icon:(0,n.jsx)(w.Z,{}),children:"\u4E0A\u4F20\u5C01\u9762"})})}),(0,n.jsx)(o.Z.Item,{label:"\u7535\u5B50\u4E66",children:(0,n.jsx)(_e.Z,{fileList:j.current,beforeUpload:function(e){if((0,H.T)(e)){var r={uid:e.uid,name:e.name,status:"done",originFileObj:e};z(function(a){return _()(_()({},a),{},{current:[r]})})}return!1},onRemove:function(){z(function(e){return _()(_()({},e),{},{current:[]})})},children:!((ne=j.current)!==null&&ne!==void 0&&ne.length)&&(0,n.jsx)(u.ZP,{icon:(0,n.jsx)(w.Z,{}),children:"\u4E0A\u4F20\u7535\u5B50\u4E66"})})})]})}),(0,n.jsx)(ye.Z,{title:"\u4E66\u7C4D\u8BE6\u60C5",width:500,open:rt,loading:ut,onClose:function(){return ue(!1)},extra:[(0,n.jsx)(u.ZP,{type:"primary",onClick:function(){ae("\u7F16\u8F91"),ue(!1),x(!0),C&&je(C)},children:"\u7F16\u8F91"},"edit")],children:C&&(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(X.vY,{column:1,dataSource:C,columns:[{title:"\u5C01\u9762",dataIndex:"cover",render:function(e,r){return r.cover?(0,n.jsx)("img",{src:r.cover,alt:"\u5C01\u9762",style:{maxWidth:"100%",maxHeight:200}}):"\u65E0\u5C01\u9762"}},{title:"ID",dataIndex:"id"},{title:"\u4E66\u540D",dataIndex:"title"},{title:"ISBN",dataIndex:"isbn"},{title:"\u4F5C\u8005",dataIndex:"author"},{title:"\u51FA\u7248\u793E",dataIndex:"press"},{title:"\u7C7B\u522B",dataIndex:"categoryId",render:function(e,r){var a=V.find(function(p){return p.value===r.categoryId});return a?a.label:"\u672A\u77E5\u7C7B\u522B"}},{title:"\u72B6\u6001",dataIndex:"status",render:function(e,r){var a=Y.L.find(function(p){return p.value===r.status});return a?(0,n.jsx)(d.Z,{status:a.badgeStatus,text:a.label}):"\u672A\u77E5\u72B6\u6001: ".concat(r.status)}},{title:"\u5E93\u5B58",dataIndex:"bookNumber"},{title:"\u7B80\u4ECB",dataIndex:"intro",render:function(e){return e||"\u6682\u65E0\u7B80\u4ECB"}},{title:"\u7535\u5B50\u4E66",dataIndex:"ebook",render:function(e,r){return r.ebook?(0,n.jsx)("a",{href:r.ebook,children:(0,O.w2)(r.ebook)}):"\u65E0\u7535\u5B50\u4E66"}},{title:"\u521B\u5EFA\u65F6\u95F4",dataIndex:"createdAt",valueType:"dateTime"},{title:"\u66F4\u65B0\u65F6\u95F4",dataIndex:"updatedAt",valueType:"dateTime"}]})})}),(0,n.jsx)(Ae.Z,{title:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(ke.Z,{}),"  \u786E\u8BA4",$,"\uFF1F"]}),open:we,onOk:ct,onCancel:pt,children:C&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("p",{children:["\u4E66\u540D\uFF1A",C.title]}),(0,n.jsxs)("p",{children:["\u4F5C\u8005\uFF1A",C.author]})]})})]})};B.default=Le},4318:function(N,B,t){t.d(B,{P4:function(){return w},ak:function(){return c},i8:function(){return X},qU:function(){return Q},u8:function(){return M},zl:function(){return D}});var h=t(15009),_=t.n(h),A=t(99289),f=t.n(A),E=t(71052);function D(o){return g.apply(this,arguments)}function g(){return g=f()(_()().mark(function o(d){return _()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,E.h)("/api/user/bookList",d));case 1:case"end":return l.stop()}},o)})),g.apply(this,arguments)}function c(o){return P.apply(this,arguments)}function P(){return P=f()(_()().mark(function o(d){return _()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,E.x)("/api/admin/bookUpload",{},{file:d.file,cover:d.cover},{data:d.bookData,fieldName:"bookData"}));case 1:case"end":return l.stop()}},o)})),P.apply(this,arguments)}function M(o){return O.apply(this,arguments)}function O(){return O=f()(_()().mark(function o(d){return _()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,E.x)("/api/admin/updateBook",{bookId:d.bookId},{file:d.file,cover:d.cover},{data:d.bookData,fieldName:"bookData"}));case 1:case"end":return l.stop()}},o)})),O.apply(this,arguments)}function H(o){return S.apply(this,arguments)}function S(){return S=_asyncToGenerator(_regeneratorRuntime().mark(function o(d){var i;return _regeneratorRuntime().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return i=new FormData,i.append("bookId",d.bookId),u.abrupt("return",api("/api/admin/deleteBook",i));case 3:case"end":return u.stop()}},o)})),S.apply(this,arguments)}function w(o){return U.apply(this,arguments)}function U(){return U=f()(_()().mark(function o(d){var i;return _()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return i=new FormData,i.append("bookId",d.bookId),u.abrupt("return",(0,E.h)("/api/user/getBookById",i));case 3:case"end":return u.stop()}},o)})),U.apply(this,arguments)}function Q(o){return T.apply(this,arguments)}function T(){return T=f()(_()().mark(function o(d){var i;return _()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return i=new FormData,i.append("bookId",d.bookId),u.abrupt("return",(0,E.h)("/api/user/getBookNumberById",i));case 3:case"end":return u.stop()}},o)})),T.apply(this,arguments)}function k(o){return R.apply(this,arguments)}function R(){return R=_asyncToGenerator(_regeneratorRuntime().mark(function o(d){var i;return _regeneratorRuntime().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return i=new FormData,i.append("bookId",d.bookId),i.append("bookNumber",d.bookNumber),u.abrupt("return",api("/api/admin/setBookNumber",d));case 4:case"end":return u.stop()}},o)})),R.apply(this,arguments)}function X(o){return Z.apply(this,arguments)}function Z(){return Z=f()(_()().mark(function o(d){var i;return _()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return i=new FormData,i.append("CategoryName",d.CategoryName),u.abrupt("return",(0,E.h)("/api/admin/addCategory",i));case 3:case"end":return u.stop()}},o)})),Z.apply(this,arguments)}},61370:function(N,B,t){t.d(B,{A:function(){return D}});var h=t(15009),_=t.n(h),A=t(99289),f=t.n(A),E=t(71052);function D(){return g.apply(this,arguments)}function g(){return g=f()(_()().mark(function c(){return _()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return M.abrupt("return",(0,E.h)("/api/user/categoryList",{}));case 1:case"end":return M.stop()}},c)})),g.apply(this,arguments)}},62362:function(N,B,t){t.d(B,{T:function(){return A},v:function(){return _}});var h=t(2453),_=function(E){var D=E.type==="image/jpeg"||E.type==="image/png";D||h.ZP.error("\u53EA\u80FD\u4E0A\u4F20 JPG/PNG \u683C\u5F0F\u56FE\u7247!");var g=E.size/1024/1024<5;return g||h.ZP.error("\u56FE\u7247\u5927\u5C0F\u4E0D\u80FD\u8D85\u8FC7 5MB!"),D&&g},A=function(E){var D=E.type==="application/pdf";D||h.ZP.error("\u6682\u4EC5\u652F\u6301 PDF \u6587\u4EF6!");var g=E.size/1024/1024<100;return g||h.ZP.error("PDF \u6587\u4EF6\u5927\u5C0F\u4E0D\u80FD\u8D85\u8FC7 100MB!"),D&&g}}}]);

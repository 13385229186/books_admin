"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[507],{89588:function(w,P,t){t.d(P,{L:function(){return h}});var h=[{value:"AVAILABLE",label:"\u53EF\u501F\u9605",badgeStatus:"success"},{value:"BORROWED",label:"\u5DF2\u501F\u5B8C",badgeStatus:"error"},{value:"MAINTENANCE",label:"\u6682\u505C\u501F\u9605",badgeStatus:"default"}]},77231:function(w,P,t){t.r(P);var h=t(97857),_=t.n(h),k=t(15009),f=t.n(k),E=t(99289),D=t.n(E),g=t(5574),m=t.n(g),B=t(4318),M=t(61370),O=t(58780),H=t(62362),S=t(51042),Y=t(88484),U=t(90930),Q=t(73580),R=t(37476),A=t(5966),T=t(64317),X=t(2485),Z=t(55102),s=t(8232),d=t(40411),i=t(2453),l=t(16568),o=t(83622),le=t(74330),q=t(71230),F=t(15746),_e=t(78367),ye=t(85265),ke=t(17788),b=t(67294),Ae=t(11475),J=t(89588),ee=t(96486),ft=t.n(ee),n=t(85893),Fe=Z.Z.TextArea,Le=function(){var te,ne,Se=s.Z.useForm(),Re=m()(Se,1),W=Re[0],Te=s.Z.useForm(),xe=m()(Te,1),de=xe[0],K=(0,b.useRef)(),Ue=(0,b.useState)(),ce=m()(Ue,2),C=ce[0],me=ce[1],Ze=(0,b.useState)([]),pe=m()(Ze,2),We=pe[0],Ke=pe[1],Ne=(0,b.useState)(!1),fe=m()(Ne,2),we=fe[0],Ye=fe[1],Je=(0,b.useState)(!1),Ee=m()(Je,2),$e=Ee[0],ae=Ee[1],Ge=(0,b.useState)("\u6DFB\u52A0"),be=m()(Ge,2),$=be[0],re=be[1],Ve=(0,b.useState)(!1),ge=m()(Ve,2),ze=ge[0],x=ge[1],He=(0,b.useState)(!1),ve=m()(He,2),Qe=ve[0],N=ve[1],Xe=(0,b.useState)({current:[],original:[]}),De=m()(Xe,2),I=De[0],G=De[1],qe=(0,b.useState)({current:[],original:[]}),he=m()(qe,2),j=he[0],V=he[1],et=(0,b.useState)([]),Be=m()(et,2),z=Be[0],tt=Be[1],nt=(0,b.useState)(!1),Pe=m()(nt,2),at=Pe[0],ue=Pe[1],rt=(0,b.useState)(!1),Oe=m()(rt,2),ut=Oe[0],Ce=Oe[1],ot=(0,b.useState)(!1),Me=m()(ot,2),st=Me[0],oe=Me[1],it=(0,b.useState)(!1),Ie=m()(it,2),lt=Ie[0],se=Ie[1],_t=[{title:"ID",dataIndex:"id",ellipsis:!0,width:50},{title:"\u4E66\u540D",dataIndex:"title",ellipsis:!0,render:function(e,a){return(0,n.jsx)("a",{onClick:function(){ue(!0),Ce(!0),(0,B.qU)({bookId:a.id}).then(function(c){Ce(!1),a.bookNumber=c.data,me(a)})},children:a.title})}},{title:"\u4F5C\u8005",dataIndex:"author",ellipsis:!0},{title:"\u7C7B\u522B",dataIndex:"categoryId",ellipsis:!0,valueType:"select",fieldProps:{options:z},render:function(e,a){var r=z.find(function(c){return c.value===a.categoryId});return r?r.label:"\u672A\u77E5\u7C7B\u522B"}},{title:"\u72B6\u6001",dataIndex:"status",valueType:"select",fieldProps:{options:J.L},ellipsis:!0,render:function(e,a){var r=J.L.find(function(c){return c.value===a.status});return r?(0,n.jsx)(d.Z,{status:r.badgeStatus,text:r.label}):"\u672A\u77E5\u72B6\u6001: ".concat(a.status)}},{title:"\u66F4\u65B0\u65F6\u95F4",dataIndex:"updatedAt",valueType:"dateTime",search:!1,ellipsis:!0},{title:"\u64CD\u4F5C",dataIndex:"option",valueType:"option",width:100,render:function(e,a){return[(0,n.jsx)("a",{onClick:function(){(0,B.qU)({bookId:a.id}).then(function(c){a.bookNumber=c.data,me(a),x(!0),re("\u7F16\u8F91"),je(a)})},children:"\u7F16\u8F91"},"edit-".concat(a.id))]}}],dt=function(){var u=D()(f()().mark(function e(a){var r;return f()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return a=(0,O.cz)(a),ae(!0),v.next=4,(0,B.zl)(a);case 4:if(r=v.sent,r.status!=="fail"){v.next=9;break}return i.ZP.error(r.msg),ae(!1),v.abrupt("return");case 9:return ae(!1),Ke(r.data.data.map(function(p){return{id:p.id,title:p.title,author:p.author,categoryId:p.categoryId,status:p.status,createdAt:p.createdAt,cover:p.cover?(0,O.OR)(p.cover):p.cover,ebook:p.ebook?(0,O.OR)(p.ebook):p.ebook,intro:p.intro,press:p.press,isbn:p.isbn,updatedAt:p.updatedAt}})),v.abrupt("return",r.data);case 12:case"end":return v.stop()}},e)}));return function(a){return u.apply(this,arguments)}}(),ct=function(){},mt=function(){Ye(!1)},ie=function(){W.resetFields(),V({current:[],original:[]}),G({current:[],original:[]})},je=function(e){if(console.log(e),!!e){if(W.setFieldsValue({title:e.title,isbn:e.isbn,author:e.author,press:e.press,categoryId:e.categoryId,status:e.status,intro:e.intro,bookNumber:e.bookNumber}),e.cover){var a={uid:"-cover",name:(0,O.w2)(e.cover),status:"done",url:e.cover};G({current:[a],original:[a]})}if(e.ebook){var r={uid:"-ebook",name:(0,O.w2)(e.ebook),status:"done",url:e.ebook};V({current:[r],original:[r]})}}};(0,b.useEffect)(function(){(0,M.A)().then(function(u){tt(u.data.map(function(e){return{label:e.name,value:e.id}}))})},[]);var pt=function(){var u=D()(f()().mark(function e(a){var r,c,v,p;return f()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if($!=="\u6DFB\u52A0"){y.next=8;break}r={bookData:a},I.current[0]&&(r.cover=I.current[0].originFileObj),j.current[0]&&(r.file=j.current[0].originFileObj),N(!0),(0,B.ak)(r).then(function(L){N(!1),L.status==="success"?(l.ZP.destroy(),l.ZP.success({message:L.msg}),K.current&&K.current.reload(),x(!1),ie()):(l.ZP.destroy(),l.ZP.error({message:L.msg}))}),y.next=19;break;case 8:if($!=="\u7F16\u8F91"){y.next=19;break}if(C){y.next=12;break}return i.ZP.error("\u5F53\u524D\u64CD\u4F5C\u8BB0\u5F55\u4E0D\u8BE6\uFF0C\u8BF7\u91CD\u8BD5"),y.abrupt("return");case 12:N(!0),c={bookId:C.id,bookData:a},v=I.original!=null&&!(0,ee.isEqual)(I.current,I.original),v&&(c.cover=I.current[0].originFileObj),p=j.original!=null&&!(0,ee.isEqual)(j.current,j.original),p&&(c.file=j.current[0].originFileObj),(0,B.u8)(c).then(function(L){N(!1),L.status==="success"?(l.ZP.destroy(),l.ZP.success({message:L.msg}),K.current&&K.current.reload(),x(!1),ie()):(l.ZP.destroy(),l.ZP.error({message:L.msg}))});case 19:case"end":return y.stop()}},e)}));return function(a){return u.apply(this,arguments)}}();return(0,n.jsxs)(U._z,{title:"\u4E66\u7C4D\u7BA1\u7406",children:[(0,n.jsx)(Q.Z,{headerTitle:"\u4E66\u7C4D\u5217\u8868",actionRef:K,rowKey:"id",pagination:{pageSize:5},loading:$e,toolBarRender:function(){return[(0,n.jsxs)(o.ZP,{type:"primary",onClick:function(){re("\u6DFB\u52A0"),x(!0)},children:[(0,n.jsx)(S.Z,{})," \u6DFB\u52A0\u4E66\u7C4D"]},"primary"),(0,n.jsxs)(o.ZP,{type:"primary",onClick:function(){oe(!0)},children:[(0,n.jsx)(S.Z,{})," \u6DFB\u52A0\u7C7B\u522B"]},"primary")]},request:dt,columns:_t,dataSource:We}),(0,n.jsx)(R.Y,{title:"\u6DFB\u52A0\u4E66\u7C4D\u7C7B\u522B",width:"400px",form:de,open:st,onOpenChange:function(e){oe(e),e||se(!1)},onFinish:function(){var u=D()(f()().mark(function e(a){return f()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:se(!0);try{(0,B.i8)({CategoryName:a.categoryName}).then(function(v){v.status==="fail"?i.ZP.error(v.msg):(oe(!1),de.resetFields(),i.ZP.success("\u7C7B\u522B\u6DFB\u52A0\u6210\u529F\uFF1A"+a.categoryName))})}catch(v){i.ZP.error("\u7C7B\u522B\u6DFB\u52A0\u5931\u8D25")}finally{se(!1)}case 2:case"end":return c.stop()}},e)}));return function(e){return u.apply(this,arguments)}}(),children:(0,n.jsx)(le.Z,{spinning:lt,tip:"\u6DFB\u52A0\u4E2D...",children:(0,n.jsx)(A.Z,{label:"\u7C7B\u522B\u540D\u79F0",rules:[{required:!0,message:"\u7C7B\u522B\u540D\u79F0\u5FC5\u586B\uFF01"}],name:"categoryName",placeholder:"\u8BF7\u8F93\u5165\u7C7B\u522B\u540D\u79F0"})})}),(0,n.jsx)(R.Y,{title:$+"\u4E66\u7C4D",width:"800px",form:W,open:ze,onOpenChange:function(e){x(e),e||(ie(),N(!1))},onFinish:pt,children:(0,n.jsxs)(le.Z,{spinning:Qe,tip:"\u4E0A\u4F20\u4E2D...",children:[(0,n.jsxs)(q.Z,{gutter:16,children:[(0,n.jsx)(F.Z,{span:12,children:(0,n.jsx)(A.Z,{label:"\u4E66\u540D",rules:[{required:!0,message:"\u4E66\u540D\u5FC5\u586B\uFF01"}],name:"title",placeholder:"\u8BF7\u8F93\u5165\u4E66\u540D"})}),(0,n.jsx)(F.Z,{span:12,children:(0,n.jsx)(A.Z,{label:"ISBN",rules:[{required:!0,message:"ISBN\u5FC5\u586B\uFF01"}],name:"isbn",placeholder:"\u8BF7\u8F93\u5165ISBN"})})]}),(0,n.jsxs)(q.Z,{gutter:16,children:[(0,n.jsx)(F.Z,{span:12,children:(0,n.jsx)(A.Z,{label:"\u4F5C\u8005",rules:[{required:!0,message:"\u4F5C\u8005\u5FC5\u586B\uFF01"}],name:"author",placeholder:"\u8BF7\u8F93\u5165\u4F5C\u8005"})}),(0,n.jsx)(F.Z,{span:12,children:(0,n.jsx)(A.Z,{label:"\u51FA\u7248\u793E",rules:[{required:!0,message:"\u51FA\u7248\u793E\u5FC5\u586B\uFF01"}],name:"press",placeholder:"\u8BF7\u8F93\u5165\u51FA\u7248\u793E"})})]}),(0,n.jsxs)(q.Z,{gutter:16,children:[(0,n.jsx)(F.Z,{span:8,children:(0,n.jsx)(T.Z,{label:"\u7C7B\u522B",name:"categoryId",rules:[{required:!0,message:"\u7C7B\u522B\u5FC5\u9009\uFF01"}],options:z,placeholder:"\u8BF7\u9009\u62E9\u7C7B\u522B"})}),(0,n.jsx)(F.Z,{span:8,children:(0,n.jsx)(T.Z,{label:"\u72B6\u6001",name:"status",rules:[{required:!0,message:"\u72B6\u6001\u5FC5\u9009\uFF01"}],initialValue:"MAINTENANCE",options:J.L,placeholder:"\u8BF7\u9009\u62E9\u72B6\u6001",fieldProps:{onChange:function(e){e==="BORROWED"&&W.setFieldsValue({bookNumber:0})}}})}),(0,n.jsx)(F.Z,{span:8,children:(0,n.jsx)(A.Z,{label:"\u5E93\u5B58",rules:[{required:!0,message:"\u5E93\u5B58\u6570\u91CF\u5FC5\u586B\uFF01"}],initialValue:0,name:"bookNumber",placeholder:"\u8BF7\u8F93\u5165\u5E93\u5B58\u6570\u91CF",fieldProps:{type:"number",min:0,onChange:function(e){var a=e.target.value;a==="0"&&W.setFieldsValue({status:"MAINTENANCE"})}}})})]}),(0,n.jsx)(s.Z.Item,{label:"\u4E66\u7C4D\u7B80\u4ECB",name:"intro",children:(0,n.jsx)(Fe,{rows:4,placeholder:"\u8BF7\u8F93\u5165\u4E66\u7C4D\u7B80\u4ECB"})}),(0,n.jsx)(s.Z.Item,{label:"\u4E66\u7C4D\u5C01\u9762",children:(0,n.jsx)(_e.Z,{fileList:I.current,beforeUpload:function(e){if((0,H.v)(e)){var a={uid:e.uid,name:e.name,status:"done",originFileObj:e};G(function(r){return _()(_()({},r),{},{current:[a]})})}return!1},onRemove:function(){G(function(e){return _()(_()({},e),{},{current:[]})})},children:!((te=I.current)!==null&&te!==void 0&&te.length)&&(0,n.jsx)(o.ZP,{icon:(0,n.jsx)(Y.Z,{}),children:"\u4E0A\u4F20\u5C01\u9762"})})}),(0,n.jsx)(s.Z.Item,{label:"\u7535\u5B50\u4E66",children:(0,n.jsx)(_e.Z,{fileList:j.current,beforeUpload:function(e){if((0,H.T)(e)){var a={uid:e.uid,name:e.name,status:"done",originFileObj:e};V(function(r){return _()(_()({},r),{},{current:[a]})})}return!1},onRemove:function(){V(function(e){return _()(_()({},e),{},{current:[]})})},children:!((ne=j.current)!==null&&ne!==void 0&&ne.length)&&(0,n.jsx)(o.ZP,{icon:(0,n.jsx)(Y.Z,{}),children:"\u4E0A\u4F20\u7535\u5B50\u4E66"})})})]})}),(0,n.jsx)(ye.Z,{title:"\u4E66\u7C4D\u8BE6\u60C5",width:500,open:at,loading:ut,onClose:function(){return ue(!1)},extra:[(0,n.jsx)(o.ZP,{type:"primary",onClick:function(){re("\u7F16\u8F91"),ue(!1),x(!0),C&&je(C)},children:"\u7F16\u8F91"},"edit")],children:C&&(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(X.vY,{column:1,dataSource:C,columns:[{title:"\u5C01\u9762",dataIndex:"cover",render:function(e,a){return a.cover?(0,n.jsx)("img",{src:a.cover,alt:"\u5C01\u9762",style:{maxWidth:"100%",maxHeight:200}}):"\u65E0\u5C01\u9762"}},{title:"ID",dataIndex:"id"},{title:"\u4E66\u540D",dataIndex:"title"},{title:"ISBN",dataIndex:"isbn"},{title:"\u4F5C\u8005",dataIndex:"author"},{title:"\u51FA\u7248\u793E",dataIndex:"press"},{title:"\u7C7B\u522B",dataIndex:"categoryId",render:function(e,a){var r=z.find(function(c){return c.value===a.categoryId});return r?r.label:"\u672A\u77E5\u7C7B\u522B"}},{title:"\u72B6\u6001",dataIndex:"status",render:function(e,a){var r=J.L.find(function(c){return c.value===a.status});return r?(0,n.jsx)(d.Z,{status:r.badgeStatus,text:r.label}):"\u672A\u77E5\u72B6\u6001: ".concat(a.status)}},{title:"\u5E93\u5B58",dataIndex:"bookNumber"},{title:"\u7B80\u4ECB",dataIndex:"intro",render:function(e){return e||"\u6682\u65E0\u7B80\u4ECB"}},{title:"\u7535\u5B50\u4E66",dataIndex:"ebook",render:function(e,a){return a.ebook?(0,n.jsx)("a",{href:a.ebook,children:(0,O.w2)(a.ebook)}):"\u65E0\u7535\u5B50\u4E66"}},{title:"\u521B\u5EFA\u65F6\u95F4",dataIndex:"createdAt",valueType:"dateTime"},{title:"\u66F4\u65B0\u65F6\u95F4",dataIndex:"updatedAt",valueType:"dateTime"}]})})}),(0,n.jsx)(ke.Z,{title:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Ae.Z,{}),"  \u786E\u8BA4",$,"\uFF1F"]}),open:we,onOk:ct,onCancel:mt,children:C&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("p",{children:["\u4E66\u540D\uFF1A",C.title]}),(0,n.jsxs)("p",{children:["\u4F5C\u8005\uFF1A",C.author]})]})})]})};P.default=Le},4318:function(w,P,t){t.d(P,{P4:function(){return Y},ak:function(){return m},i8:function(){return X},qU:function(){return Q},u8:function(){return M},zl:function(){return D}});var h=t(15009),_=t.n(h),k=t(99289),f=t.n(k),E=t(71052);function D(s){return g.apply(this,arguments)}function g(){return g=f()(_()().mark(function s(d){return _()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,E.h)("/api/user/bookList",d));case 1:case"end":return l.stop()}},s)})),g.apply(this,arguments)}function m(s){return B.apply(this,arguments)}function B(){return B=f()(_()().mark(function s(d){return _()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,E.x)("/api/admin/bookUpload",{},{file:d.file,cover:d.cover},{data:d.bookData,fieldName:"bookData"}));case 1:case"end":return l.stop()}},s)})),B.apply(this,arguments)}function M(s){return O.apply(this,arguments)}function O(){return O=f()(_()().mark(function s(d){return _()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,E.x)("/api/admin/updateBook",{bookId:d.bookId},{file:d.file,cover:d.cover},{data:d.bookData,fieldName:"bookData"}));case 1:case"end":return l.stop()}},s)})),O.apply(this,arguments)}function H(s){return S.apply(this,arguments)}function S(){return S=_asyncToGenerator(_regeneratorRuntime().mark(function s(d){var i;return _regeneratorRuntime().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return i=new FormData,i.append("bookId",d.bookId),o.abrupt("return",api("/api/admin/deleteBook",i));case 3:case"end":return o.stop()}},s)})),S.apply(this,arguments)}function Y(s){return U.apply(this,arguments)}function U(){return U=f()(_()().mark(function s(d){var i;return _()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return i=new FormData,i.append("bookId",d.bookId),o.abrupt("return",(0,E.h)("/api/user/getBookById",i));case 3:case"end":return o.stop()}},s)})),U.apply(this,arguments)}function Q(s){return R.apply(this,arguments)}function R(){return R=f()(_()().mark(function s(d){var i;return _()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return i=new FormData,i.append("bookId",d.bookId),o.abrupt("return",(0,E.h)("/api/user/getBookNumberById",i));case 3:case"end":return o.stop()}},s)})),R.apply(this,arguments)}function A(s){return T.apply(this,arguments)}function T(){return T=_asyncToGenerator(_regeneratorRuntime().mark(function s(d){var i;return _regeneratorRuntime().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return i=new FormData,i.append("bookId",d.bookId),i.append("bookNumber",d.bookNumber),o.abrupt("return",api("/api/admin/setBookNumber",d));case 4:case"end":return o.stop()}},s)})),T.apply(this,arguments)}function X(s){return Z.apply(this,arguments)}function Z(){return Z=f()(_()().mark(function s(d){var i;return _()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return i=new FormData,i.append("CategoryName",d.CategoryName),o.abrupt("return",(0,E.h)("/api/admin/addCategory",i));case 3:case"end":return o.stop()}},s)})),Z.apply(this,arguments)}},61370:function(w,P,t){t.d(P,{A:function(){return D}});var h=t(15009),_=t.n(h),k=t(99289),f=t.n(k),E=t(71052);function D(){return g.apply(this,arguments)}function g(){return g=f()(_()().mark(function m(){return _()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return M.abrupt("return",(0,E.h)("/api/user/categoryList",{}));case 1:case"end":return M.stop()}},m)})),g.apply(this,arguments)}},62362:function(w,P,t){t.d(P,{T:function(){return k},v:function(){return _}});var h=t(2453),_=function(E){var D=E.type==="image/jpeg"||E.type==="image/png";D||h.ZP.error("\u53EA\u80FD\u4E0A\u4F20 JPG/PNG \u683C\u5F0F\u56FE\u7247!");var g=E.size/1024/1024<5;return g||h.ZP.error("\u56FE\u7247\u5927\u5C0F\u4E0D\u80FD\u8D85\u8FC7 5MB!"),D&&g},k=function(E){var D=E.type==="application/pdf";D||h.ZP.error("\u6682\u4EC5\u652F\u6301 PDF \u6587\u4EF6!");var g=E.size/1024/1024<100;return g||h.ZP.error("PDF \u6587\u4EF6\u5927\u5C0F\u4E0D\u80FD\u8D85\u8FC7 100MB!"),D&&g}}}]);

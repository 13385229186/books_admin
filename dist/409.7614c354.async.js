"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[409],{89588:function(M,F,n){n.d(F,{L:function(){return y}});var y=[{value:"AVAILABLE",label:"\u53EF\u501F\u9605",badgeStatus:"success"},{value:"BORROWED",label:"\u5DF2\u501F\u5B8C",badgeStatus:"error"},{value:"MAINTENANCE",label:"\u6682\u505C\u501F\u9605",badgeStatus:"default"}]},93409:function(M,F,n){n.d(F,{Z:function(){return Be}});var y=n(97857),l=n.n(y),L=n(15009),f=n.n(L),B=n(99289),S=n.n(B),O=n(5574),w=n.n(O),k=n(67294),_=n(2453),N=n(17788),A=n(74330),C=n(96074),T=n(71230),h=n(15746),u=n(26412),E=n(40411),D=n(66309),I=n(38925),K=n(78957),R=n(83622),t=n(58780),s=n(34666),r={detailContainer:"detailContainer___kYhFH",sectionContainer:"sectionContainer___edjfj",sectionHeader:"sectionHeader____mHax",sectionIcon:"sectionIcon___Op7JA",sectionTitle:"sectionTitle___EXYMG",sectionContent:"sectionContent___KGV6u",avatarCol:"avatarCol___icY0O",userAvatar:"userAvatar___Y6Sjv",detailDescriptions:"detailDescriptions___fRzk9","ant-descriptions-item-label":"ant-descriptions-item-label___CULOn","ant-descriptions-item-content":"ant-descriptions-item-content___FkfIn",borrowDescriptions:"borrowDescriptions___KqVCu",bookTitle:"bookTitle___wG399",lowCredit:"lowCredit___zj6XQ",lowStock:"lowStock___NAXfu",statusContainer:"statusContainer___U5Lka",statusAlert:"statusAlert___pK7NV",actionContainer:"actionContainer___Hld_A",actionDivider:"actionDivider___FfLhF",anticon:"anticon___co7UE",actionButtons:"actionButtons___d9hS7",actionButton:"actionButton___MBAea"},p=n(41874),o=n(4318),de=n(40614),q=n(89588),me=n(29177),pe=n(98721),ve=n(13923),fe=n(43425),he=n(88284),ee=n(8751),be=n(51040),De=n(74070),e=n(85893),ge=function(P){var G,Y,J,V,U=P.visible,z=P.onCancel,ne=P.record,X=P.borrowId,H=P.handleStatusChange,re=P.loading,x=re===void 0?!1:re,ae=P.showActions,_e=ae===void 0?!0:ae,Ee=(0,k.useState)(null),te=w()(Ee,2),d=te[0],ue=te[1],je=(0,k.useState)(),oe=w()(je,2),j=oe[0],ke=oe[1],we=(0,k.useState)(),se=w()(we,2),g=se[0],Ce=se[1],Ie=(0,k.useState)(!1),ie=w()(Ie,2),Fe=ie[0],le=ie[1],ye=function(){var m=S()(f()().mark(function v(b){var c;return f()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,(0,de.$B)({id:b});case 3:if(c=a.sent,c.status!=="success"){a.next=6;break}return a.abrupt("return",c.data.data[0]);case 6:return _.ZP.error(c.msg||"\u83B7\u53D6\u501F\u9605\u8BB0\u5F55\u5931\u8D25"),a.abrupt("return",null);case 10:return a.prev=10,a.t0=a.catch(0),console.error("\u83B7\u53D6\u501F\u9605\u8BB0\u5F55\u5931\u8D25:",a.t0),_.ZP.error("\u83B7\u53D6\u501F\u9605\u8BB0\u5F55\u5931\u8D25"),a.abrupt("return",null);case 15:case"end":return a.stop()}},v,null,[[0,10]])}));return function(b){return m.apply(this,arguments)}}(),Re=function(){var m=S()(f()().mark(function v(b){var c,Z,a;return f()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(i.prev=0,le(!0),!b.userId){i.next=7;break}return i.next=5,(0,p.GA)({userId:b.userId});case 5:c=i.sent,c.status==="success"?ke(c.data):_.ZP.error(c.msg||"\u83B7\u53D6\u7528\u6237\u4FE1\u606F\u5931\u8D25");case 7:if(!b.bookId){i.next=19;break}return i.next=10,(0,o.P4)({bookId:b.bookId});case 10:if(Z=i.sent,Z.status!=="success"){i.next=18;break}return i.next=14,(0,o.qU)({bookId:b.bookId});case 14:a=i.sent,a.status==="success"?Ce(l()(l()({},Z.data),{},{bookNumber:a.data})):_.ZP.error(a.msg||"\u83B7\u53D6\u4E66\u7C4D\u5E93\u5B58\u5931\u8D25"),i.next=19;break;case 18:_.ZP.error(Z.msg||"\u83B7\u53D6\u4E66\u7C4D\u4FE1\u606F\u5931\u8D25");case 19:i.next=25;break;case 21:i.prev=21,i.t0=i.catch(0),console.error("\u83B7\u53D6\u6570\u636E\u5931\u8D25:",i.t0),_.ZP.error("\u83B7\u53D6\u6570\u636E\u5931\u8D25");case 25:return i.prev=25,le(!1),i.finish(25);case 28:case"end":return i.stop()}},v,null,[[0,21,25,28]])}));return function(b){return m.apply(this,arguments)}}();(0,k.useEffect)(function(){var m=function(){var v=S()(f()().mark(function b(){var c;return f()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!U){a.next=7;break}if(c=ne,!(!c&&X)){a.next=6;break}return a.next=5,ye(X);case 5:c=a.sent;case 6:c?(ue(c),Re(c)):ue(null);case 7:case"end":return a.stop()}},b)}));return function(){return v.apply(this,arguments)}}();m()},[U,ne,X]);var ce=function(v){var b,c=new Date,Z=new Date(v.createdAt),a=v.dueTime?new Date(v.dueTime):null;switch(v.status){case"APPLIED":{var W=new Date(Z.getTime()+864e5),i=Math.floor((W.getTime()-c.getTime())/(60*60*1e3));return{message:"\u72B6\u6001\uFF1A\u5DF2\u7533\u8BF7 | \u53D6\u4E66\u65F6\u95F4\uFF1A".concat(W?(0,t.o0)(W)+"\u524D":"\u672A\u8BBE\u7F6E"),additionalInfo:i>0?"".concat(i>0?"\u5269\u4F59".concat(i,"\u5C0F\u65F6"):"\u5DF2\u8D85\u65F6"):"\u8D85\u8FC7\u53D6\u4E66\u671F\u9650\uFF0C\u9884\u7EA6\u5DF2\u5931\u6548"}}case"BORROWED":{var Q=a?Math.floor((a.getTime()-c.getTime())/864e5):null;return{message:"\u72B6\u6001: \u501F\u9605\u4E2D | \u5E94\u8FD8\u65E5\u671F: ".concat(a?(0,t.o0)(a):"\u672A\u8BBE\u7F6E"),additionalInfo:Q!==null?Q>-1?"\u5269\u4F59".concat(Q,"\u5929"):"\u5DF2\u8D85\u8FC7\u8FD8\u4E66\u671F\u9650":""}}case"OVERDUE":{var Se=a?Math.floor((c.getTime()-a.getTime())/864e5):0;return{message:"\u72B6\u6001: \u5DF2\u903E\u671F | \u8D85\u671F".concat(Se,"\u5929"),additionalInfo:"\u8BF7\u8054\u7CFB\u7528\u6237\u5C3D\u5FEB\u5F52\u8FD8"}}case"RETURNED":return{message:"\u72B6\u6001: \u5DF2\u5F52\u8FD8 | \u5F52\u8FD8\u65F6\u95F4: ".concat(v.returnTime?(0,t.o0)(new Date(v.returnTime)):"\u672A\u77E5")};default:return{message:"\u72B6\u6001: ".concat(((b=s.S.find(function(Ne){return Ne.value===v.status}))===null||b===void 0?void 0:b.label)||v.status)}}},Ze=function(v){switch(v){case"APPLIED":return"info";case"BORROWED":return"info";case"CANCELLED":return"info";case"OVERDUE":return"warning";case"RETURNED":return"success";case"LOST":return"error";default:return"info"}},$=function(){var m=S()(f()().mark(function v(b,c){return f()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(a.prev=0,!H){a.next=5;break}return a.next=4,H(b,c);case 4:z();case 5:a.next=10;break;case 7:a.prev=7,a.t0=a.catch(0),console.error("\u72B6\u6001\u53D8\u66F4\u5931\u8D25:",a.t0);case 10:case"end":return a.stop()}},v,null,[[0,7]])}));return function(b,c){return m.apply(this,arguments)}}();return d?(0,e.jsx)(N.Z,{title:"\u501F\u9605\u8BB0\u5F55\u8BE6\u60C5",open:U,onCancel:z,footer:null,width:800,style:{padding:"24px"},children:(0,e.jsx)(A.Z,{spinning:Fe,children:(0,e.jsxs)("div",{className:r.detailContainer,children:[(0,e.jsxs)("div",{className:r.sectionContainer,children:[(0,e.jsxs)(C.Z,{orientation:"left",className:r.actionDivider,children:[(0,e.jsx)(me.Z,{})," \u7528\u6237\u4FE1\u606F"]}),(0,e.jsxs)(T.Z,{gutter:24,align:"middle",className:r.sectionContent,children:[(0,e.jsx)(h.Z,{span:12,children:(0,e.jsxs)(u.Z,{column:1,className:r.detailDescriptions,children:[(0,e.jsx)(u.Z.Item,{label:"\u7528\u6237ID",children:d.userId}),(0,e.jsx)(u.Z.Item,{label:"\u4FE1\u8A89\u5206",children:(0,e.jsx)("span",{className:(j==null?void 0:j.creditScore)<60?r.lowCredit:"",children:(j==null?void 0:j.creditScore)||"\u672A\u77E5"})})]})}),(0,e.jsx)(h.Z,{span:12,children:(0,e.jsxs)(u.Z,{column:1,className:r.detailDescriptions,children:[(0,e.jsx)(u.Z.Item,{label:"\u59D3\u540D",children:(j==null?void 0:j.name)||"\u672A\u77E5"}),(0,e.jsx)(u.Z.Item,{label:"\u7535\u8BDD",children:(j==null?void 0:j.phone)||"\u672A\u63D0\u4F9B"})]})})]})]}),(0,e.jsxs)("div",{className:r.sectionContainer,children:[(0,e.jsxs)(C.Z,{orientation:"left",className:r.actionDivider,children:[(0,e.jsx)(pe.Z,{})," \u4E66\u7C4D\u4FE1\u606F"]}),(0,e.jsxs)(T.Z,{gutter:24,className:r.sectionContent,children:[(0,e.jsx)(h.Z,{span:12,children:(0,e.jsxs)(u.Z,{column:1,className:r.detailDescriptions,children:[(0,e.jsx)(u.Z.Item,{label:"\u4E66\u7C4DID",children:g==null?void 0:g.id}),(0,e.jsx)(u.Z.Item,{label:"\u4E66\u7C4D\u72B6\u6001",children:(0,e.jsx)(E.Z,{status:(G=q.L.find(function(m){return m.value===(g==null?void 0:g.status)}))===null||G===void 0?void 0:G.badgeStatus,text:((Y=q.L.find(function(m){return m.value===(g==null?void 0:g.status)}))===null||Y===void 0?void 0:Y.label)||"\u672A\u77E5"})})]})}),(0,e.jsx)(h.Z,{span:12,children:(0,e.jsxs)(u.Z,{column:1,className:r.detailDescriptions,children:[(0,e.jsx)(u.Z.Item,{label:"\u4E66\u540D",children:(0,e.jsx)("span",{className:r.bookTitle,children:(g==null?void 0:g.title)||"\u672A\u77E5"})}),(0,e.jsx)(u.Z.Item,{label:"\u5E93\u5B58",children:(0,e.jsx)("span",{className:(g==null?void 0:g.bookNumber)<=0?r.lowStock:"",children:g==null?void 0:g.bookNumber})})]})})]})]}),(0,e.jsxs)("div",{className:r.sectionContainer,children:[(0,e.jsxs)(C.Z,{orientation:"left",className:r.actionDivider,children:[(0,e.jsx)(ve.Z,{})," \u501F\u9605\u8BE6\u60C5"]}),(0,e.jsx)("div",{className:r.sectionContent,children:(0,e.jsxs)(u.Z,{bordered:!0,column:2,className:r.detailDescriptions,children:[(0,e.jsx)(u.Z.Item,{label:"\u501F\u9605ID",children:d.id}),(0,e.jsx)(u.Z.Item,{label:"\u5F53\u524D\u72B6\u6001",children:(0,e.jsx)(D.Z,{color:(J=s.S.find(function(m){return m.value===d.status}))===null||J===void 0?void 0:J.color,children:(V=s.S.find(function(m){return m.value===d.status}))===null||V===void 0?void 0:V.label})}),(0,e.jsx)(u.Z.Item,{label:"\u7533\u8BF7\u65F6\u95F4",children:(0,t.o0)(new Date(d.createdAt))}),d.borrowTime&&(0,e.jsx)(u.Z.Item,{label:"\u53D6\u4E66\u65F6\u95F4",children:(0,t.o0)(new Date(d.borrowTime))}),d.dueTime&&(0,e.jsx)(u.Z.Item,{label:"\u5E94\u8FD8\u65E5\u671F",children:(0,t.o0)(new Date(d.dueTime))}),d.returnTime&&(0,e.jsx)(u.Z.Item,{label:"\u5F52\u8FD8\u65F6\u95F4",children:(0,t.o0)(new Date(d.returnTime))})]})})]}),(0,e.jsx)("div",{className:r.statusContainer,children:(0,e.jsx)(I.Z,{message:ce(d).message,description:ce(d).additionalInfo,type:Ze(d.status),showIcon:!0,className:r.statusAlert})}),_e&&H&&(0,e.jsxs)("div",{className:r.actionContainer,children:[(0,e.jsxs)(C.Z,{orientation:"left",className:r.actionDivider,children:[(0,e.jsx)(fe.Z,{})," \u7BA1\u7406\u5458\u64CD\u4F5C"]}),(0,e.jsxs)(K.Z,{size:"large",className:r.actionButtons,children:[d.status==="APPLIED"&&(0,e.jsx)(R.ZP,{type:"primary",icon:(0,e.jsx)(he.Z,{}),loading:x,onClick:function(){return $(d.id,"BORROWED")},className:r.actionButton,children:"\u6279\u51C6\u501F\u9605"}),d.status==="BORROWED"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(R.ZP,{type:"primary",icon:(0,e.jsx)(ee.Z,{}),loading:x,onClick:function(){return $(d.id,"RETURNED")},className:r.actionButton,children:"\u6807\u8BB0\u5F52\u8FD8"}),(0,e.jsx)(R.ZP,{danger:!0,icon:(0,e.jsx)(be.Z,{}),loading:x,onClick:function(){return $(d.id,"LOST")},className:r.actionButton,children:"\u6807\u8BB0\u4E22\u5931"})]}),d.status==="OVERDUE"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(R.ZP,{type:"primary",icon:(0,e.jsx)(ee.Z,{}),loading:x,onClick:function(){return $(d.id,"RETURNED")},className:r.actionButton,children:"\u6807\u8BB0\u5F52\u8FD8"}),(0,e.jsx)(R.ZP,{icon:(0,e.jsx)(De.Z,{}),loading:x,onClick:function(){return _.ZP.warning("\u8BF7\u5148\u8054\u7CFB\u7528\u6237\u786E\u8BA4\u4E66\u7C4D\u72B6\u6001")},className:r.actionButton,children:"\u53D1\u9001\u50AC\u8FD8"})]})]})]})]})})}):(0,e.jsx)(N.Z,{title:"\u501F\u9605\u8BB0\u5F55\u8BE6\u60C5",open:U,onCancel:z,footer:null,width:800,children:(0,e.jsxs)("div",{style:{textAlign:"center",padding:"40px 0"},children:[(0,e.jsx)(A.Z,{size:"large"}),(0,e.jsx)("p",{children:"\u6B63\u5728\u52A0\u8F7D\u501F\u9605\u8BB0\u5F55..."})]})})},Be=ge},34666:function(M,F,n){n.d(F,{S:function(){return y}});var y=[{value:"APPLIED",label:"\u5DF2\u7533\u8BF7",color:"blue"},{value:"BORROWED",label:"\u501F\u9605\u4E2D",color:"green"},{value:"RETURNED",label:"\u5DF2\u5F52\u8FD8",color:"cyan"},{value:"OVERDUE",label:"\u5DF2\u903E\u671F",color:"red"},{value:"LOST",label:"\u5DF2\u4E22\u5931",color:"magenta"},{value:"CANCELLED",label:"\u5DF2\u53D6\u6D88",color:"gray"},{value:"EXPIRED",label:"\u5DF2\u8FC7\u671F",color:"orange"}]},4318:function(M,F,n){n.d(F,{P4:function(){return T},ak:function(){return w},i8:function(){return K},qU:function(){return u},u8:function(){return _},zl:function(){return S}});var y=n(15009),l=n.n(y),L=n(99289),f=n.n(L),B=n(71052);function S(t){return O.apply(this,arguments)}function O(){return O=f()(l()().mark(function t(s){return l()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.abrupt("return",(0,B.h)("/api/user/bookList",s));case 1:case"end":return p.stop()}},t)})),O.apply(this,arguments)}function w(t){return k.apply(this,arguments)}function k(){return k=f()(l()().mark(function t(s){return l()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.abrupt("return",(0,B.x)("/api/admin/bookUpload",{},{file:s.file,cover:s.cover},{data:s.bookData,fieldName:"bookData"}));case 1:case"end":return p.stop()}},t)})),k.apply(this,arguments)}function _(t){return N.apply(this,arguments)}function N(){return N=f()(l()().mark(function t(s){return l()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.abrupt("return",(0,B.x)("/api/admin/updateBook",{bookId:s.bookId},{file:s.file,cover:s.cover},{data:s.bookData,fieldName:"bookData"}));case 1:case"end":return p.stop()}},t)})),N.apply(this,arguments)}function A(t){return C.apply(this,arguments)}function C(){return C=_asyncToGenerator(_regeneratorRuntime().mark(function t(s){var r;return _regeneratorRuntime().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return r=new FormData,r.append("bookId",s.bookId),o.abrupt("return",api("/api/admin/deleteBook",r));case 3:case"end":return o.stop()}},t)})),C.apply(this,arguments)}function T(t){return h.apply(this,arguments)}function h(){return h=f()(l()().mark(function t(s){var r;return l()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return r=new FormData,r.append("bookId",s.bookId),o.abrupt("return",(0,B.h)("/api/user/getBookById",r));case 3:case"end":return o.stop()}},t)})),h.apply(this,arguments)}function u(t){return E.apply(this,arguments)}function E(){return E=f()(l()().mark(function t(s){var r;return l()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return r=new FormData,r.append("bookId",s.bookId),o.abrupt("return",(0,B.h)("/api/user/getBookNumberById",r));case 3:case"end":return o.stop()}},t)})),E.apply(this,arguments)}function D(t){return I.apply(this,arguments)}function I(){return I=_asyncToGenerator(_regeneratorRuntime().mark(function t(s){var r;return _regeneratorRuntime().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return r=new FormData,r.append("bookId",s.bookId),r.append("bookNumber",s.bookNumber),o.abrupt("return",api("/api/admin/setBookNumber",s));case 4:case"end":return o.stop()}},t)})),I.apply(this,arguments)}function K(t){return R.apply(this,arguments)}function R(){return R=f()(l()().mark(function t(s){var r;return l()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return r=new FormData,r.append("CategoryName",s.CategoryName),o.abrupt("return",(0,B.h)("/api/admin/addCategory",r));case 3:case"end":return o.stop()}},t)})),R.apply(this,arguments)}},40614:function(M,F,n){n.d(F,{$B:function(){return C},Ck:function(){return O},XG:function(){return N},Zl:function(){return k}});var y=n(15009),l=n.n(y),L=n(99289),f=n.n(L),B=n(71052),S=n(58780);function O(h){return w.apply(this,arguments)}function w(){return w=f()(l()().mark(function h(u){var E;return l()().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return E=new FormData,E.append("bookId",u.bookId),E.append("borrowDays",u.borrowDays.toString()),I.abrupt("return",(0,B.h)("/api/user/borrowBook",E));case 4:case"end":return I.stop()}},h)})),w.apply(this,arguments)}function k(h){return _.apply(this,arguments)}function _(){return _=f()(l()().mark(function h(u){return l()().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return D.abrupt("return",(0,B.h)("/api/admin/borrowList",u));case 1:case"end":return D.stop()}},h)})),_.apply(this,arguments)}function N(h){return A.apply(this,arguments)}function A(){return A=f()(l()().mark(function h(u){return l()().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return D.abrupt("return",(0,B.h)("/api/admin/setBorrowStatus",u));case 1:case"end":return D.stop()}},h)})),A.apply(this,arguments)}function C(h){return T.apply(this,arguments)}function T(){return T=f()(l()().mark(function h(u){return l()().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return D.abrupt("return",(0,B.h)("/api/admin/borrowList",(0,S.cz)(u)));case 1:case"end":return D.stop()}},h)})),T.apply(this,arguments)}}}]);
